.include "../50002/nominal.jsim"
.include "../50002/stdcell.jsim"
.include "../50002/lab3multiply.jsim"

// full adder
.subckt fulladder a b ci s co
Xsum1 a b  n xor2
Xsum2 n ci s xor2
Xnand1 a b  ab nand2
Xnand2 a ci ac nand2
Xnand3 b ci bc nand2
Xnand4 ab ac bc co nand3
.ends

// full adder for multiply
.subckt FA a b ain cin s co
Xand a   b   bin and2
Xfa  ain bin cin s co fulladder
.ends

//multiply32 bit
.subckt alu ALUFN[5:0] A[31:0] B[31:0] alu[31:0] z v n
//the first row
Xand1 A[31:0] B0#32  P[31:0] and2

Xbuf0 P0      alu[0] buffer

// a cascade of buffer
Xadder1    A[30:0]   B1#31  P[31:1]  0  C1[29:0]    P1[31:1]    C1[31:1]    FA
Xadder2    A[29:0]   B2#30  P1[31:2]  0  C2[29:1]    P2[31:2]    C2[31:2]    FA
Xadder3    A[28:0]   B3#29  P2[31:3]  0  C3[29:2]    P3[31:3]    C3[31:3]    FA
Xadder4    A[27:0]   B4#28  P3[31:4]  0  C4[29:3]    P4[31:4]    C4[31:4]    FA
Xadder5    A[26:0]   B5#27  P4[31:5]  0  C5[29:4]    P5[31:5]    C5[31:5]    FA
Xadder6    A[25:0]   B6#26  P5[31:6]  0  C6[29:5]    P6[31:6]    C6[31:6]    FA
Xadder7    A[24:0]   B7#25  P6[31:7]  0  C7[29:6]    P7[31:7]    C7[31:7]    FA
Xadder8    A[23:0]   B8#24  P7[31:8]  0  C8[29:7]    P8[31:8]    C8[31:8]    FA
Xadder9    A[22:0]   B9#23  P8[31:9]  0  C9[29:8]    P9[31:9]    C9[31:9]    FA
Xadder10    A[21:0]   B10#22  P9[31:10]  0  C10[29:9]    P10[31:10]    C10[31:10]    FA
Xadder11    A[20:0]   B11#21  P10[31:11]  0  C11[29:10]    P11[31:11]    C11[31:11]    FA
Xadder12    A[19:0]   B12#20  P11[31:12]  0  C12[29:11]    P12[31:12]    C12[31:12]    FA
Xadder13    A[18:0]   B13#19  P12[31:13]  0  C13[29:12]    P13[31:13]    C13[31:13]    FA
Xadder14    A[17:0]   B14#18  P13[31:14]  0  C14[29:13]    P14[31:14]    C14[31:14]    FA
Xadder15    A[16:0]   B15#17  P14[31:15]  0  C15[29:14]    P15[31:15]    C15[31:15]    FA
Xadder16    A[15:0]   B16#16  P15[31:16]  0  C16[29:15]    P16[31:16]    C16[31:16]    FA
Xadder17    A[14:0]   B17#15  P16[31:17]  0  C17[29:16]    P17[31:17]    C17[31:17]    FA
Xadder18    A[13:0]   B18#14  P17[31:18]  0  C18[29:17]    P18[31:18]    C18[31:18]    FA
Xadder19    A[12:0]   B19#13  P18[31:19]  0  C19[29:18]    P19[31:19]    C19[31:19]    FA
Xadder20    A[11:0]   B20#12  P19[31:20]  0  C20[29:19]    P20[31:20]    C20[31:20]    FA
Xadder21    A[10:0]   B21#11  P20[31:21]  0  C21[29:20]    P21[31:21]    C21[31:21]    FA
Xadder22    A[9:0]   B22#10  P21[31:22]  0  C22[29:21]    P22[31:22]    C22[31:22]    FA
Xadder23    A[8:0]   B23#9  P22[31:23]  0  C23[29:22]    P23[31:23]    C23[31:23]    FA
Xadder24    A[7:0]   B24#8  P23[31:24]  0  C24[29:23]    P24[31:24]    C24[31:24]    FA
Xadder25    A[6:0]   B25#7  P24[31:25]  0  C25[29:24]    P25[31:25]    C25[31:25]    FA
Xadder26    A[5:0]   B26#6  P25[31:26]  0  C26[29:25]    P26[31:26]    C26[31:26]    FA
Xadder27    A[4:0]   B27#5  P26[31:27]  0  C27[29:26]    P27[31:27]    C27[31:27]    FA
Xadder28    A[3:0]   B28#4  P27[31:28]  0  C28[29:27]    P28[31:28]    C28[31:28]    FA
Xadder29    A[2:0]   B29#3  P28[31:29]  0  C29[29:28]    P29[31:29]    C29[31:29]    FA
Xadder30    A[1:0]   B30#2  P29[31:30]  0  C30[29:29]    P30[31:30]    C30[31:30]    FA
Xadder31    A[0:0]   B31#1  P30[31:31]  0    P31[31:31]    C31[31:31]    FA


Xbuf1  P11     alu[1]   buffer
Xbuf2  P22     alu[2]   buffer
Xbuf3  P33     alu[3]   buffer
Xbuf4  P44     alu[4]   buffer
Xbuf5  P55     alu[5]   buffer
Xbuf6  P66     alu[6]   buffer
Xbuf7  P77     alu[7]   buffer
Xbuf8  P88     alu[8]   buffer
Xbuf9  P99     alu[9]   buffer
Xbuf10 P1010   alu[10]  buffer
Xbuf11 P1111   alu[11]  buffer
Xbuf12 P1212   alu[12]  buffer
Xbuf13 P1313   alu[13]  buffer
Xbuf14 P1414   alu[14]  buffer
Xbuf15 P1515   alu[15]  buffer
Xbuf16 P1616   alu[16]  buffer
Xbuf17 P1717   alu[17]  buffer
Xbuf18 P1818   alu[18]  buffer
Xbuf19 P1919   alu[19]  buffer
Xbuf20 P2020   alu[20]  buffer
Xbuf21 P2121   alu[21]  buffer
Xbuf22 P2222   alu[22]  buffer
Xbuf23 P2323   alu[23]  buffer
Xbuf24 P2424   alu[24]  buffer
Xbuf25 P2525   alu[25]  buffer
Xbuf26 P2626   alu[26]  buffer
Xbuf27 P2727   alu[27]  buffer
Xbuf28 P2828   alu[28]  buffer
Xbuf29 P2929   alu[29]  buffer
Xbuf30 P3030   alu[30]  buffer
Xbuf31 P3131   alu[31]  buffer
.ends